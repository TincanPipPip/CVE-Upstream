# Migration configuration for performances.
id: seatgeek_performance
label: Performance migration
migration_group: seatgeek
source:  
  plugin: seatgeek_performance  
  data_fetcher_plugin: http
  data_parser_plugin: seatgeek_xml
  # gets overridden by config
  urls: https://tickets.ticket.com
  item_selector: /feed/Show/events/Event
  fields:
    -
      name: EventInstanceId
      label: Performance ID
      selector: EventLocalId    
    -
      name: Time
      label: Performance date
      selector: ActualEventDate
    -
      name: OnSaleOnWeb
      label: On sale
      selector: AvailableForDisplay
    -
      name: DirectLink
      label: Link
      selector: DirectLink
    -
      name: SoldOut
      label: SoldOut
      selector: SoldOut
    -
      name: Event
      label: Parent XML element
      selector: ../../ID
  ids:
    EventInstanceId:
      type: int
destination:
  plugin: entity:performances
  default_bundle: performance
process:
  field_perf_date:
    plugin: format_date
    from_format: 'Y-m-d\TH:i:s'
    to_format: 'Y-m-d\TH:i:s'
    from_timezone: 'Europe/London'
    to_timezone: 'UTC'
    source: Time
  field_seatgeek_perf_id: EventInstanceId
  field_event:
    plugin: migration    
    migration: seatgeek_event
    source: Event
  title: EventInstanceId
  field_onsale: OnSaleOnWeb
  field_perf_booking_link: DirectLink
#  field_sold_out:
#    plugin: static_map
#    source: SoldOut
#    map:
#      'True': 1
#      'False': 0
#      'true': 1
#      'false': 0
migration_dependencies:
  optional:
    - seatgeek_event    
dependencies:
  module:
    - seatgeek_import
  enforced:
    module:
      - migrate_plus
      - seatgeek_import
