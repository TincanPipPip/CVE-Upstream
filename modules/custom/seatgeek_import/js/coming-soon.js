(function ($) {
  Drupal.behaviors.seatGeekComingSoon = {
    attach: function (context, settings) {      
      
      function updateCountdown(){
		$(context).find('a.coming-soon').each(function(index, item){
          // Count down to exposed timestamp (*1000) and modify booking link
			var timestamp = parseInt($(item).attr('data-sale-start')) * 1000;            
			var target = new Date();
			var now = new Date();

			target.setTime(timestamp);
			var totalMilliSeconds = target.getTime() - now.getTime();
			
			var totalSeconds = parseInt(totalMilliSeconds / 1000);
			
            if (totalSeconds < 0) {
              $(item).attr('href', $(item).attr('data-booking'));
              $(item).html('Book now');
              $(item).removeClass('no-click');
            }
		});

		window.setTimeout(updateCountdown, 1000);
      }
      updateCountdown();
    
    }
  };
})(jQuery);